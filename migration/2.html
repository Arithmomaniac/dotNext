<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Migration from 2.x | .NEXT </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Migration from 2.x | .NEXT ">
      
      <link rel="icon" href="../fav.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.json">
      <meta name="docfx:tocrel" content="toc.json">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/dotnet/dotNext/blob/gh-pages/docs/migration/2.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">
  </head>

  <script type="module" src="./../public/docfx.min.js"></script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../doc_logo.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="migration-from-2x">Migration from 2.x</h1>

<p>3.x is mostly compatible with 2.x. However, there are several minor and major incompatible changes in API surface.</p>
<h1 id="multiple-targets">Multiple Targets</h1>
<p>.NEXT provides multi-target build:</p>
<ul>
<li>.NET Standard 2.1</li>
<li>.NET Core 3.1 (only for <code>DotNext.AspNetCore.Cluster</code> library)</li>
<li>.NET 5</li>
</ul>
<p>All API provided by .NET Standard 2.1 build is available in .NET 5 build but not vice versa. Build for .NET 5 contains some extra types.</p>
<h1 id="incompatible-changes">Incompatible Changes</h1>
<h2 id="value-delegates">Value Delegates</h2>
<p>Value Delegates has been dropped from 3.x version due to the following reasons:</p>
<ul>
<li>C# 9 has support of function pointers at language level</li>
<li>Value delegate introduces another level of indirection</li>
<li>No way for the method relying on the value delegate to inline the actual method referenced by the instance of value delegate</li>
</ul>
<p>As a result, value delegates completely replaced by functional interfaces as described in <a href="https://github.com/dotnet/csharplang/issues/3452">this</a> proposal. This approach has many benefits:</p>
<ul>
<li>It can be used to represent function pointer and reference to the delegate instance without performance loss</li>
<li>There is no additional level of indirection</li>
<li>The method expecting implementation of functional interface has a chance to inline the actual implementation</li>
</ul>
<p>Functional intefaces are much verbose but very flexible. However, their complexity is hidden from the consumer of .NEXT libraries. All public APIs relying on value delegates replaced with the following overloaded methods:</p>
<ul>
<li>CLS-compliant version that expects an instance of regular delegate</li>
<li>Unsafe version that expects function pointer of specific signature</li>
</ul>
<h2 id="augmented-compilation">Augmented Compilation</h2>
<p><code>DotNext.Augmentation.Fody</code> was introduced to obtain value delegates from function pointers in C# 8. Now it's not needed because C# 9 has syntax for function pointers.</p>
<h2 id="write-ahead-log">Write-Ahead Log</h2>
<p>Some methods of <code>IAuditTrail&lt;TEntry&gt;</code> interface refactored to simplify their signature. For example, <code>ReadAsync</code> method now doesn't accept log entry consumer as a generic parameter.</p>
<h2 id="obsolete-members-and-classes">Obsolete Members and Classes</h2>
<p>All obsolete members and classes in 2.x has been removed.</p>
<h2 id="arrayrentalt">ArrayRental&lt;T&gt;</h2>
<p><code>ArrayRental&lt;T&gt;</code> type has been replaced with <code>MemoryOwner&lt;T&gt;</code> type.</p>
<h2 id="dynamicinvoker">DynamicInvoker</h2>
<p><code>DynamicInvoker</code> delegate now uses <a href="https://docs.microsoft.com/en-us/dotnet/api/system.span-1">Span&lt;T&gt;</a> as a container for variadic arguments instead of array to avoid memory allocation in reflection scenarios.</p>
<h2 id="buffers">Buffers</h2>
<p><code>BufferWriterSlim&lt;T&gt;</code> always copies initial buffer to the rented buffer on overflow.</p>
<p><code>MemoryWriter&lt;T&gt;</code> has been renamed to <code>BufferWriter&lt;T&gt;</code>.</p>
<h2 id="boxt">Box&lt;T&gt;</h2>
<p><code>Box&lt;T&gt;</code> moved from <code>DotNext.Runtime.CompilerServices</code> to <code>DotNext.Runtime</code> namespace.</p>
<h2 id="enummember-api">EnumMember API</h2>
<p><code>Enum&lt;T&gt;</code> type providing EnumMember API has been removed. .NET 5 provides all necessary static methods of <a href="https://docs.microsoft.com/en-us/dotnet/api/system.enum">Enum</a> class. Methods for obtaining attributes have been moved to <code>DotNext.Reflection.EnumType</code> type.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/dotnet/dotNext/blob/gh-pages/docs/migration/2.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Supported by the <a href="https://dotnetfoundation.org">.NET Foundation</a>
        </div>
      </div>
    </footer>
  </body>
</html>
